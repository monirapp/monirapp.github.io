(self.AMP=self.AMP||[]).push({n:"amp-app-banner",v:"0",f:(function(AMP,_){
function g(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};function h(a){for(var b=null,c="",d=0;d<arguments.length;d++){var e=arguments[d];if(e instanceof Error&&!b){var b=void 0,f=e.message,m=String(Math.random());e.message=m;if(e.message===m)e.message=f,b=e;else{f=Error(e.message);for(b in e)f[b]=e[b];f.stack=e.stack;b=f}}else c&&(c+=" "),c+=e}b?c&&(b.message=c+": "+b.message):b=Error(c);return b}function k(a){var b=h.apply(null,arguments);setTimeout(function(){self.reportError(b);throw b;})}self.log=self.log||{user:null,dev:null,userForEmbed:null};
var l=self.log;function n(){if(!l.user)throw Error("failed to call initLogConstructor");return l.user}function p(){if(l.dev)return l.dev;throw Error("failed to call initLogConstructor");};function q(a){return a||{}};function r(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function t(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;if(b=b!=(b.__AMP_TOP||b)&&u(b,"url")?v(b,"url"):null)return b}return w(a,"url")}function x(a,b){a=a.__AMP_TOP||a;return v(a,b)}function w(a,b){a=y(a);a=z(a);return v(a,b)}function y(a){return a.nodeType?x((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function z(a){a=y(a);return a.isSingleDoc()?a.win:a}
function v(a,b){u(a,b);var c=A(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function B(a){var b;(b=A(a).storage)?b.promise?b=b.promise:(v(a,"storage"),b=b.promise=Promise.resolve(b.obj)):b=null;var c=b;if(c)return c;var d=new r,e=d;b=e.promise;e=e.resolve;A(a).storage={obj:null,promise:b,resolve:e,context:null,ctor:null};return b}function A(a){var b=a.services;b||(b=a.services={});return b}
function u(a,b){a=a.services&&a.services[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function C(a,b){var c;try{a.open(b,"_top",c)}catch(d){p().error("DOM","Failed to open url on target: ","_top",d)}};function D(a){a=AMP.BaseElement.call(this,a)||this;a.l=null;a.h=!1;return a}g(D,AMP.BaseElement);D.prototype.openButtonClicked=function(){};function E(a,b,c,d){b.addEventListener("click",function(){a.openButtonClicked(c,d)})}D.prototype.A=function(){this.getVsync().run({measure:void 0,mutate:F},{element:this.element,viewport:this.getViewport(),storagePromise:B(z(this.getAmpDoc())),storageKey:G(this)})};
function G(a){var b=n().assert(a.element.id,"amp-app-banner should have an id.");return"amp-app-banner:"+b}D.prototype.isDismissed=function(){var a=this;return B(z(this.getAmpDoc())).then(function(b){return b.get(G(a))}).then(function(a){return!!a},function(a){p().error("amp-app-banner","Failed to read storage",a);return!1})};
function H(a){a.isDismissed().then(function(b){if(b)I(a);else{var c=a.win.document.createElement("i-amphtml-app-banner-top-padding");a.element.appendChild(c);c=a.win.document.createElement("button");c.classList.add("amp-app-banner-dismiss-button");c.setAttribute("aria-label",a.element.getAttribute("data-dismiss-button-aria-label")||"Dismiss");var d=a.A.bind(a);c.addEventListener("click",d);a.element.appendChild(c);a.getVsync().run({measure:J,mutate:K},{element:a.element,viewport:a.getViewport()});
a.expand()}})}function I(a){return a.getVsync().runPromise({measure:void 0,mutate:L},{element:a.element,viewport:a.getViewport()})}function M(a){return D.call(this,a)||this}g(M,D);M.prototype.upgradeCallback=function(){var a=x(this.win,"platform");return a.isIos()?new N(this.element):a.isAndroid()?new O(this.element):null};M.prototype.layoutCallback=function(){n().info("amp-app-banner","Only iOS or Android platforms are currently supported.");return I(this)};
function N(a){a=D.call(this,a)||this;a.c=null;a.o=null;return a}g(N,D);N.prototype.preconnectCallback=function(a){this.element.parentNode&&this.preconnect.url("https://itunes.apple.com",a)};
N.prototype.buildCallback=function(){this.c=w(this.getAmpDoc(),"viewer");var a=x(this.win,"platform");(this.h=!this.c.isEmbedded()&&a.isSafari())?(n().info("amp-app-banner","Browser supports builtin banners. Not rendering amp-app-banner."),I(this)):this.c.isEmbedded()&&!this.c.hasCapability("navigateTo")?I(this):(this.o=this.win.document.head.querySelector("meta[name=apple-itunes-app]"))?(this.l=n().assert(this.element.querySelector("button[open-button]"),"<button open-button> is required inside %s: %s",
"amp-app-banner",this.element),P(this,this.o.getAttribute("content")),H(this)):I(this)};N.prototype.layoutCallback=function(){return Promise.resolve()};N.prototype.openButtonClicked=function(a,b){var c=this;this.c.isEmbedded()?(x(this.win,"timer").delay(function(){c.c.sendMessage("navigateTo",q({url:b}))},1500),this.c.sendMessage("navigateTo",q({url:a}))):(x(this.win,"timer").delay(function(){C(c.win,b)},1500),C(this.win,a))};
function P(a,b){var c=b.replace(/\s/,"").split(","),d={};c.forEach(function(a){var b=a.split("=");d[b[0]]=b[1]});var e=d["app-id"],f=d["app-argument"];f?n().assert(t(a.element).isProtocolValid(f),"The url in app-argument has invalid protocol: %s",f):n().error("amp-app-banner",'<meta name="apple-itunes-app">\'s content should contain app-argument to allow opening an already installed application on iOS.');var m="https://itunes.apple.com/us/app/id"+e;E(a,a.l,f||m,m)}
function O(a){a=D.call(this,a)||this;a.m=null;a.j="";a.w=!1;return a}g(O,D);O.prototype.preconnectCallback=function(a){this.element.parentNode&&(this.preconnect.url("https://play.google.com",a),this.j&&this.preconnect.preload(this.j))};
O.prototype.buildCallback=function(){var a=this.win,b=this.element,c=w(this.getAmpDoc(),"viewer");this.m=a.document.head.querySelector("link[rel=manifest],link[rel=origin-manifest]");var d=x(a,"platform"),e=t(b),f=d.isAndroid()&&d.isChrome(),m=e.isProxyOrigin(a.location);(this.h=!m&&!c.isEmbedded()&&f)?(n().info("amp-app-banner","Browser supports builtin banners. Not rendering amp-app-banner."),I(this)):(this.w=d.isAndroid()&&!this.m)?I(this):(this.j=this.m.getAttribute("href"),e.assertHttpsUrl(this.j,
b,"manifest href"),this.l=n().assert(b.querySelector("button[open-button]"),"<button open-button> is required inside %s: %s","amp-app-banner",b),H(this))};
O.prototype.layoutCallback=function(){var a=this;return this.w||this.h?Promise.resolve():x(this.win,"xhr").fetchJson(this.j,{requireAmpResponseSourceOrigin:!1}).then(function(a){return a.json()}).then(function(b){var c;a:{if(c=b.related_applications){for(var d=0;d<c.length;d++){var e=c[d];if("play"==e.platform){c="https://play.google.com/store/apps/details?id="+e.id;var e=e.id,d=a.element,f=y(d),f=z(f),f=v(f,"documentInfo").get().canonicalUrl,f=t(d).parse(f),d=f.protocol.replace(":","");E(a,a.l,"android-app://"+
e+"/"+d+"/"+f.host+f.pathname,c);c=void 0;break a}}n().warn("amp-app-banner","Could not find a platform=play app in manifest: %s",a.element)}else n().warn("amp-app-banner","related_applications is missing from manifest.json file: %s",a.element);c=void 0}return c}).catch(function(b){I(a);k(b)})};O.prototype.openButtonClicked=function(a,b){var c=this;x(this.win,"timer").delay(function(){c.win.top.location.assign(b)},1500);C(this.win,a)};
function F(a){L(a);a.storagePromise.then(function(b){b.set(a.storageKey,!0)})}function L(a){a.viewport.removeFromFixedLayer(a.element);var b=a.element;b.parentElement&&b.parentElement.removeChild(b);a.viewport.updatePaddingBottom(0)}function J(a){a.bannerHeight=a.viewport.getLayoutRect(a.element).height}function K(a){a.viewport.updatePaddingBottom(a.bannerHeight);a.viewport.addToFixedLayer(a.element)}(function(a){a.registerElement("amp-app-banner",M,"amp-app-banner{position:fixed!important;bottom:0!important;left:0;width:100%;max-height:100px!important;box-sizing:border-box;background:#fff;z-index:13;box-shadow:0 0 5px 0 rgba(0,0,0,0.2)!important}i-amphtml-app-banner-top-padding{position:absolute;top:0;left:0;right:0;background:#fff;height:4px;z-index:15}.amp-app-banner-dismiss-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='13' height='13' viewBox='341 8 13 13' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%234F4F4F' d='M354 9.31L352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z' fill-rule='evenodd'/%3E%3C/svg%3E\");background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;z-index:14;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0}.amp-app-banner-dismiss-button:before{position:absolute;content:\"\";top:-20px;right:0;left:-20px;bottom:0}[dir=rtl] .amp-app-banner-dismiss-button{right:auto;left:0;border-top-left-radius:0;border-top-right-radius:12px;background-position:6px}[dir=rtl] .amp-app-banner-dismiss-button:before{right:-20px;left:0}\n/*# sourceURL=/extensions/amp-app-banner/0.1/amp-app-banner.css*/")})(self.AMP);
})});
//# sourceMappingURL=amp-app-banner-0.1.js.map

