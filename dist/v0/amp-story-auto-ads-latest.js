(self.AMP=self.AMP||[]).push({n:"amp-story-auto-ads",v:"0",f:(function(AMP,_){
function h(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};self.log=self.log||{user:null,dev:null,userForEmbed:null};var m=self.log;function p(){if(!m.user)throw Error("failed to call initLogConstructor");return m.user};var q=Object.prototype.hasOwnProperty;function r(a){var b=Object.create(null);a&&Object.assign(b,a);return b}function t(a){return a||{}};function u(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function v(a,b){a=a.__AMP_TOP||a;return w(a,b)}function x(a){return a.nodeType?v((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function y(a){a=x(a);return a.isSingleDoc()?a.win:a}function w(a,b){var c=z(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function A(a,b){var c=B(a,b);if(c)return c;var d=new u,e=d,f=e.promise,e=e.resolve;z(a)[b]={obj:null,promise:f,resolve:e,context:null,ctor:null};return f}
function B(a,b){var c=z(a)[b];if(c){if(c.promise)return c.promise;w(a,b);return c.promise=Promise.resolve(c.obj)}return null}function z(a){var b=a.services;b||(b=a.services={});return b};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function C(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){var e=new d.MutationObserver(function(){b(a)&&(e.disconnect(),c())});e.observe(a,{childList:!0})}else var f=d.setInterval(function(){b(a)&&(d.clearInterval(f),c())},5)}}function D(a,b){C(a.documentElement,function(){return!!a.body},b)}function E(a){return new Promise(function(b){D(a,b)})}function F(a,b,c){a=a.createElement(b);for(var d in c)a.setAttribute(d,c[d]);return a};function G(a){var b=B(a,"story-store");return b?b:I(a)}function J(a){var b=x(a),c=B(y(a),"amp-analytics-instrumentation");return c?c:b.whenBodyAvailable().then(function(){return K(b.win,"amp-analytics",b.getHeadNode())}).then(function(){var c=b.win;return c.ampExtendedElements&&c.ampExtendedElements["amp-analytics"]?A(y(a),"amp-analytics-instrumentation"):null})}
function K(a,b,c){var d;if(c){d=[];c=c.querySelectorAll("script[custom-element]");for(var e=0;e<c.length;e++)d.push(c[e].getAttribute("custom-element"))}else d=[];if(!d.includes(b))return Promise.resolve();var f=v(a,"extensions");return f.waitForExtension(a,b)}function I(a){return E(a.document).then(function(){return K(a,"amp-story",a.document.head)}).then(function(){return a.ampExtendedElements&&a.ampExtendedElements["amp-story"]?A(a,"story-store"):null})};t({c:!0,v:!0,a:!0,ad:!0});var L,M="Webkit webkit Moz moz ms O o".split(" ");function N(a){var b={"font-size":"0",opactiy:"0",transform:"scale(0)"},c;for(c in b){var d=a,e=b[c],f;f=d.style;var g=c;if(2>g.length?0:0==g.lastIndexOf("--",0))f=g;else{L||(L=r());var k=L[g];if(!k){k=g;if(void 0===f[g]){var l=g.charAt(0).toUpperCase()+g.slice(1);b:{for(var n=0;n<M.length;n++){var H=M[n]+l;if(void 0!==f[H]){l=H;break b}}l=""}void 0!==f[l]&&(k=l)}L[g]=k}f=k}f&&(d.style[f]=e)}};function O(a,b,c){J(a).then(function(d){d&&d.triggerEventForTarget(a,b,c)})};var P={APPLY_NOW:"Apply Now",BOOK_NOW:"Book",BUY_TICKETS:"Buy Tickets",DOWNLOAD:"Download",EXPLORE:"Explore Now",GET_NOW:"Get Now",INSTALL:"Install Now",LISTEN:"Listen Now",MORE:"More",OPEN_APP:"Open App",ORDER_NOW:"Order Now",PLAY:"Play",READ:"Read Now",SHOP:"Shop Now",SHOW:"Show",SHOWTIMES:"Showtimes",SIGN_UP:"Sign Up",SUBSCRIBE:"Subscribe Now",USE_APP:"Use App",VIEW:"View",WATCH:"Watch",WATCH_EPISODE:"Watch Episode"},Q=r({custom:!0,doubleclick:!0});
function R(a){a=AMP.BaseElement.call(this,a)||this;a.h=null;a.G=null;a.C=0;a.I=t({});a.l=[];a.H=-Infinity;a.J=0;a.m=0;a.F=null;a.A=!1;a.D={};a.j={};a.o={};a.w=null;a.B=null;return a}h(R,AMP.BaseElement);
R.prototype.buildCallback=function(){var a=this;return G(this.win).then(function(b){a.B=b;if(a.B.get("caninsertautomaticad")){var c=a.element.parentElement;p().assert("AMP-STORY"===c.tagName,"<amp-story-auto-ads> should be child of <amp-story>");var d=a.getAmpDoc(),e=v(a.win,"extensions");e.installExtensionForDoc(d,"amp-ad");e.installExtensionForDoc(d,"amp-mustache");return c.getImpl().then(function(b){a.h=b})}})};R.prototype.isLayoutSupported=function(){return!0};
R.prototype.layoutCallback=function(){var a=this;if(!this.B.get("caninsertautomaticad"))return Promise.resolve();this.G=this.h.getNavigationState();this.G.observe(this.K.bind(this));return this.h.signals().whenSignal("ini-load").then(function(){var b=a.win.document.createElement("aside");b.className="i-amphtml-ad-overlay-container";var c=a.win.document.createElement("p");c.className="i-amphtml-story-ad-attribution";c.textContent="Ad";b.appendChild(c);a.h.element.appendChild(b);b=a.element.children[0];
p().assert("SCRIPT"==b.tagName&&b.hasAttribute("type")&&"APPLICATION/JSON"==b.getAttribute("type").toUpperCase(),'The <amp-story-auto-ads> config should be inside a <script> tag with type="application/json"');a.D=JSON.parse(b.textContent);b=a.D["ad-attributes"];p().assert(b,'<amp-story-auto-ads>: Error reading config.Top level JSON should have an "ad-attributes" key');b=b.type;p().assert(b,'<amp-story-auto-ads>: Error reading config.Missing ["ad-attribues"]["type"] key');S(a)})};
function S(a){var b=T(a);a.l.push(b);a.h.element.appendChild(b);var c={};U(a,"story-ad-request",(c.requestTime=Date.now(),c));b.getImpl().then(function(b){a.h.addPage(b);a.H=Date.now()})}
function T(a){var b=V(a),c=W(a),d=a.win.document.createElement("div");d.classList.add("i-amphtml-glass-pane");var e=a.win.document.createElement("amp-story-grid-layer");e.setAttribute("template","fill");var f=e.cloneNode(!1);e.appendChild(c);f.appendChild(d);b.appendChild(e);b.appendChild(f);a.F=c;a.A=!1;c.getImpl().then(function(a){var b=a.signals();return b.whenSignal("ini-load")}).then(function(){b.getImpl().then(function(a){return a.delegateVideoAutoplay()});var c=a.l[a.l.length-1];c.removeAttribute("i-amphtml-loading");
var d={};U(a,"story-ad-load",(d.loadTime=Date.now(),d));a.A=!0});return b}function V(a){var b=++a.m,c="i-amphtml-ad-page-"+b;a.o[c]=b;var d={},e=a.j;d.adIndex=b;var f=a.win,g;f.crypto&&f.crypto.getRandomValues?(g=new Uint8Array(16),f.crypto.getRandomValues(g)):g=null;e[b]=(d.adUniqueId=g?g.join(""):String(f.location.href+Date.now()+f.Math.random()+f.screen.width+f.screen.height),d);b=t({id:c,ad:"",distance:"2","i-amphtml-loading":""});return F(a.win.document,"amp-story-page",b)}
function W(a){var b={"class":"i-amphtml-story-ad",layout:"fill","amp-story":""},c=a.D["ad-attributes"];["height","width","layout"].forEach(function(a){void 0!==c[a]&&(p().warn("amp-story-auto-ads",'ad-attribute "'+a+'" is not allowed'),delete c[a])});p().assert(!!Q[c.type],"amp-story-auto-ads: "+('"'+c.type+'" ad type is not supported'));var d=Object.assign({},c,b);return F(a.win.document,"amp-ad",d)}
function X(a,b,c,d){var e=a.win.document.createElement("a");e.className="i-amphtml-story-ad-link";e.setAttribute("target","_blank");N(e);e.href=d;e.textContent=c;if("https:"!==e.protocol&&"http:"!==e.protocol)return p().warn("amp-story-auto-ads","CTA url is not valid. Ad was discarded"),!1;var f=a.m;e.addEventListener("click",function(){var b={},c=(b.adIndex=f,b.clickTime=Date.now(),b);Y(a,"story-ad-click",c)});var g=a.win.document.createElement("amp-story-cta-layer");g.appendChild(e);b.appendChild(g);
return!0}
R.prototype.K=function(a){switch(a.type){case 0:var b=a.value.pageId;q.call(this.I,b)||(this.C++,this.I[b]=!0);if(0!==this.m){if(this.w){var c={};Y(this,"story-ad-exit",(c.exitTime=Date.now(),c.adIndex=this.w,c));this.w=null}if(this.o[b]){var c=this.o[b],d={};Y(this,"story-ad-view",(d.viewTime=Date.now(),d.adIndex=c,d));this.w=c}4<this.C&&(b=Z(this,b),1===b&&(c={},U(this,"story-ad-insert",(c.insertTime=Date.now(),c)),this.J++,this.C=0,S(this)),2===b&&(b={},U(this,"story-ad-discard",(b.discardTime=Date.now(),
b)),this.C=0,S(this)))}}};
function Z(a,b){var c=a.l[a.l.length-1];if(!a.A&&1E4<Date.now()-a.H)return 2;var d=a.h.getPageById(b),e=a.h.getNextPage(d);if(!e)return 0;a.B.get("desktopstate")&&(d=e,b=e.element.id,e=a.h.getNextPage(e));if(!e||!a.A||d.isAd()||e.isAd())return 0;var f;f=a.F.getAttribute("data-vars-ctaurl");var g=a.F.getAttribute("data-vars-ctatype");if(f&&g){a.j[a.m].ctaType=g;var k=P[g];g?f=X(a,c,k,f):(p().error("amp-story-auto-ads",'invalid "CTA Type" in ad response'),f=!1)}else p().error("amp-story-auto-ads",'Both CTA Type & CTA Url are required in ad-server response."'),
f=!1;var l=f;if(!l)return 2;a.h.insertPage(b,c.id);f=a.o[c.id];var n=a.h.getPageIndexById(b);a.j[f].position=n+1;return 1}function U(a,b,c){var d={};Object.assign(c,(d.adIndex=a.m,d));Y(a,b,c)}function Y(a,b,c){var d=c.adIndex;a.j[d]=Object.assign(a.j[d],c);O(a.element,b,a.j[d])}(function(a){a.registerElement("amp-story-auto-ads",R,"[desktop] amp-story-page[i-amphtml-loading]{-webkit-transform:scale(1.0) translateX(-100%) translateY(200%)!important;transform:scale(1.0) translateX(-100%) translateY(200%)!important}.i-amphtml-story-ad-link{background-color:#fff!important;border-radius:20px!important;bottom:32px!important;box-shadow:0px 2px 12px rgba(0,0,0,0.16)!important;color:#4285f4!important;font-family:Roboto,sans-serif!important;font-weight:700!important;height:36px!important;left:50%!important;letter-spacing:0.2px!important;line-height:36px;margin-left:-60px!important;position:absolute!important;text-align:center;text-decoration:none!important;width:120px!important}amp-story-page[active] .i-amphtml-story-ad-link{-webkit-animation-delay:100ms!important;animation-delay:100ms!important;-webkit-animation-duration:300ms!important;animation-duration:300ms!important;-webkit-animation-timing-function:cubic-bezier(0.4,0.0,0.2,1)!important;animation-timing-function:cubic-bezier(0.4,0.0,0.2,1)!important;-webkit-animation-fill-mode:forwards!important;animation-fill-mode:forwards!important;-webkit-animation-name:ad-cta!important;animation-name:ad-cta!important}@-webkit-keyframes ad-cta{0%{opacity:0;font-size:0px;-webkit-transform:scale(0);transform:scale(0)}to{opacity:1;font-size:13px;-webkit-transform:scale(1);transform:scale(1)}}@keyframes ad-cta{0%{opacity:0;font-size:0px;-webkit-transform:scale(0);transform:scale(0)}to{opacity:1;font-size:13px;-webkit-transform:scale(1);transform:scale(1)}}.i-amphtml-ad-overlay-container{height:24px!important;left:0!important;padding:14px 0 0!important;position:absolute!important;top:0!important;z-index:100001!important}[dir=rtl] .i-amphtml-ad-overlay-container{left:auto!important;right:0!important}[desktop] .i-amphtml-ad-overlay-container{left:calc(50vw - 22.5vh)!important;top:12.5vh!important}[dir=rtl] [desktop] .i-amphtml-ad-overlay-container{left:auto!important;right:calc(50vw - 22.5vh)!important}.i-amphtml-story-ad-attribution{color:#fff!important;font-size:18px!important;font-family:Roboto,sans-serif!important;font-weight:700!important;letter-spacing:0.5px!important;margin:0 0 0 16px!important;opacity:0!important;padding:0!important;visibility:hidden!important}[dir=rtl] .i-amphtml-story-ad-attribution{margin-left:0px!important;margin-right:16px!important}amp-story[ad-showing][desktop] .i-amphtml-story-ad-attribution{-webkit-transition:opacity 0.1s linear 0.3s;transition:opacity 0.1s linear 0.3s}amp-story[ad-showing] .i-amphtml-story-ad-attribution{visibility:visible!important;opacity:1!important}.i-amphtml-glass-pane{height:100%!important;width:100%!important;z-index:1!important}\n/*# sourceURL=/extensions/amp-story-auto-ads/0.1/amp-story-auto-ads.css*/")})(self.AMP);
})});
//# sourceMappingURL=amp-story-auto-ads-0.1.js.map

