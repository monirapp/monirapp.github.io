(self.AMP=self.AMP||[]).push({n:"amp-subscriptions",v:"0",f:(function(AMP,_){
var h;function aa(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var ba=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function ca(a){var b=Object.create(null);if(!a)return b;for(var c;c=ba.exec(a);){var d=aa(c[1],c[1]),e=c[2]?aa(c[2],c[2]):"";b[d]=e}return b};var da="";
function ea(){var a,b=a||self,c;if(b.AMP_MODE)c=b.AMP_MODE;else{c=b;var d=!!(self.AMP_CONFIG||{}).test||!1,e=ca(c.location.originalHash||c.location.hash),f=ca(c.location.search);da||(da=c.AMP_CONFIG&&c.AMP_CONFIG.v?c.AMP_CONFIG.v:"010");c=b.AMP_MODE={localDev:!1,development:!("1"!=e.development&&!c.AMP_DEV_MODE),examiner:"2"==e.development,filter:e.filter,geoOverride:e["amp-geo"],minified:!0,lite:void 0!=f.amp_lite,test:d,log:e.log,version:"0",rtvVersion:da}}return c}
;self.log=self.log||{user:null,dev:null,userForEmbed:null};var n=self.log;function u(){if(!n.user)throw Error("failed to call initLogConstructor");return n.user}function fa(){if(n.dev)return n.dev;throw Error("failed to call initLogConstructor");};var ga=Object.prototype.hasOwnProperty;function ha(){var a,b=Object.create(null);a&&Object.assign(b,a);return b}function z(a){return a||{}};function A(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function B(a,b){a=a.__AMP_TOP||a;return C(a,b)}function G(a,b){a=ia(a);a=H(a);return C(a,b)}function ia(a){return a.nodeType?B((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function H(a){a=ia(a);return a.isSingleDoc()?a.win:a}function C(a,b){ja(a,b);var c=ka(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function la(a,b){var c=ma(a,b);if(c)return c;var d=new A,e=d,f=e.promise,e=e.resolve;ka(a)[b]={obj:null,promise:f,resolve:e,context:null,ctor:null};return f}function ma(a,b){var c=ka(a)[b];if(c){if(c.promise)return c.promise;C(a,b);return c.promise=Promise.resolve(c.obj)}return null}function ka(a){var b=a.services;b||(b=a.services={});return b}function ja(a,b){a=a.services&&a.services[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function na(a,b,c){a=a.createElement(b);for(var d in c)a.setAttribute(d,c[d]);return a}function oa(a,b){for(var c,d=a;d&&d!==c;d=d.parentElement)if(b(d))return d;return null}function pa(a){return a.closest?a.closest("[subscriptions-action]"):oa(a,function(a){var b=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;return b?b.call(a,"[subscriptions-action]"):!1})}
function sa(a,b,c){var d;try{d=a.open(b,"_blank",c)}catch(e){fa().error("DOM","Failed to open url on target: ","_blank",e)}d||(d=a.open(b,"_top"));return d};function ta(a){var b=ia(a),c=ma(H(a),"amp-analytics-instrumentation");return c?c:b.whenBodyAvailable().then(function(){var a;a=b.win;var c=b.getHeadNode(),f;if(c){f=[];for(var c=c.querySelectorAll("script[custom-element]"),g=0;g<c.length;g++)f.push(c[g].getAttribute("custom-element"))}else f=[];a=f.includes("amp-analytics")?B(a,"extensions").waitForExtension(a,"amp-analytics"):Promise.resolve();return a}).then(function(){var c=b.win;return c.ampExtendedElements&&c.ampExtendedElements["amp-analytics"]?
la(H(a),"amp-analytics-instrumentation"):null})};function I(a){this.Oa=a;this.I=this.va=0;this.ha=Object.create(null)}I.prototype.has=function(a){return!!this.ha[a]};I.prototype.get=function(a){var b=this.ha[a];if(b)return b.access=++this.I,b.payload};I.prototype.put=function(a,b){this.has(a)||this.va++;this.ha[a]={payload:b,access:this.I};if(!(this.va<=this.Oa)){fa().warn("lru-cache","Trimming LRU cache");a=this.ha;var c=this.I+1,d,e;for(e in a){var f=a[e].access;f<c&&(c=f,d=e)}void 0!==d&&(delete a[d],this.va--)}};var J=self.AMP_CONFIG||{},ua={thirdParty:J.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:J.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof J.thirdPartyFrameRegex?new RegExp(J.thirdPartyFrameRegex):J.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:J.cdnUrl||"https://cdn.ampproject.org",cdnProxyRegex:("string"==typeof J.cdnProxyRegex?new RegExp(J.cdnProxyRegex):J.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,
errorReporting:J.errorReportingUrl||"https://amp-error-reporting.appspot.com/r",localDev:J.localDev||!1};var va=z({c:!0,v:!0,a:!0,ad:!0}),wa,xa,ya=/[?&]amp_js[^&]*/,za=/[?&]amp_gsa[^&]*/,Aa=/[?&]amp_r[^&]*/,Ba=/[?&]usqp[^&]*/;function Ca(a){return a.origin||L(a.location.href).origin}
function L(a){var b;wa||(wa=self.document.createElement("a"),xa=self.UrlCache||(self.UrlCache=new I(100)));var c=b?null:xa,d=wa;if(c&&c.has(a))a=c.get(a);else{d.href=a;d.protocol||(d.href=d.href);var e={href:d.href,protocol:d.protocol,host:d.host,hostname:d.hostname,port:"0"==d.port?"":d.port,pathname:d.pathname,search:d.search,hash:d.hash,origin:null};"/"!==e.pathname[0]&&(e.pathname="/"+e.pathname);if("http:"==e.protocol&&80==e.port||"https:"==e.protocol&&443==e.port)e.port="",e.host=e.hostname;
e.origin=d.origin&&"null"!=d.origin?d.origin:"data:"!=e.protocol&&e.host?e.protocol+"//"+e.host:e.href;c&&c.put(a,e);a=e}return a}function Da(a){"string"==typeof a&&(a=L(a));var b;(b="https:"==a.protocol||"localhost"==a.hostname)||(a=a.hostname,b=a.length-10,b=0<=b&&a.indexOf(".localhost",b)==b);return b}
function Ea(a,b){var c;c=void 0===c?"source":c;u().assert(null!=a,"%s %s must be available",b,c);var d=a;u().assert(Da(d)||/^(\/\/)/.test(d),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,c,d);return d};var M;function Fa(a,b,c){var d=void 0,e=a,f=c,g;g=function(a){try{return f(a)}catch(x){throw self.reportError(x),x;}};var l=Ga(),k=!1;d&&(k=d.capture);e.addEventListener(b,g,l?d:k);return function(){e&&e.removeEventListener(b,g,l?d:k);g=e=f=null}}function Ga(){if(void 0!==M)return M;M=!1;try{var a={get capture(){M=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return M};function Ha(a,b){return Fa(a,"message",b)}function Ia(a,b){var c=b,d=Fa(a,"click",function(a){try{c(a)}finally{c=null,d()}});return d};function Ja(a,b){if("."==b)return a;var c=b.split(".");for(b=0;b<c.length;b++){var d=c[b];if(d&&a&&void 0!==a[d]&&(null==a||"object"!=typeof a?0:Object.prototype.hasOwnProperty.call(a,d)))a=a[d];else{a=void 0;break}}return a}function Ka(a,b){try{return JSON.parse(a)}catch(c){b&&b(c)}};var Q,La="Webkit webkit Moz moz ms O o".split(" ");function Ma(a,b,c){if(2>b.length?0:0==b.lastIndexOf("--",0))return b;Q||(Q=ha());var d=Q[b];if(!d||c){d=b;if(void 0===a[b]){var e=b.charAt(0).toUpperCase()+b.slice(1);a:{for(var f=0;f<La.length;f++){var g=La[f]+e;if(void 0!==a[g]){e=g;break a}}e=""}var l=e;void 0!==a[l]&&(d=l)}c||(Q[b]=d)}return d}function Na(a,b){a=a.style;for(var c in b)a.setProperty(Ma(a,c),b[c].toString(),"important")};function Oa(a,b){var c="body:not(.i-amphtml-subs-loading) [subscriptions-section=loading]{display:none!important}body:not(.i-amphtml-subs-grant-yes) [subscriptions-section=content]{display:none!important}body:not(.i-amphtml-subs-grant-no) [subscriptions-section=content-not-granted]{display:none!important}body.i-amphtml-subs-delegated [subscriptions-section=actions],body.i-amphtml-subs-grant-unk [subscriptions-section=actions]{display:none!important}body.i-amphtml-subs-grant-unk [subscriptions-action]{display:none!important}[subscriptions-action]:not(.i-amphtml-subs-display),[subscriptions-actions]:not(.i-amphtml-subs-display),[subscriptions-section=actions]:not(.i-amphtml-subs-display){display:none!important}amp-subscriptions-dialog{display:block!important;position:fixed!important;bottom:0!important;left:0!important;margin-left:0!important;width:100%!important;z-index:2147483641;max-height:90vh;box-sizing:border-box;opacity:1;background-image:none;background-color:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);margin-bottom:0;-webkit-transition:-webkit-transform 0.3s ease-in;transition:-webkit-transform 0.3s ease-in;transition:transform 0.3s ease-in;transition:transform 0.3s ease-in,-webkit-transform 0.3s ease-in}.i-amphtml-subs-dialog-close-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='13' height='13' viewBox='341 8 13 13' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%234F4F4F' d='M354 9.31L352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z' fill-rule='evenodd'/%3E%3C/svg%3E\");background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0;cursor:pointer}body:not(.i-amphtml-subs-grant-yes) .i-amphtml-subs-dialog-close-button{display:none}.i-amphtml-subs-progress{height:2px;background-color:#ccc;position:relative;margin:8px;overflow:hidden}.i-amphtml-subs-progress:after{content:\"\";background-color:#2196f3;height:2px;position:absolute;left:0;top:0;width:20%;-webkit-animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite;animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite}@-webkit-keyframes i-amphtml-subs-loading-progress{0%{-webkit-transform:translateX(-100%);transform:translateX(-100%)}to{-webkit-transform:translateX(500%);transform:translateX(500%)}}@keyframes i-amphtml-subs-loading-progress{0%{-webkit-transform:translateX(-100%);transform:translateX(-100%)}to{-webkit-transform:translateX(500%);transform:translateX(500%)}}@media (min-width:480px){amp-subscriptions-dialog{width:480px!important;left:-240px!important;margin-left:50vw!important}}\n/*# sourceURL=/extensions/amp-subscriptions/0.1/amp-subscriptions.css*/",
d=!1,e="amp-subscriptions",f=a.getHeadNode(),g=Pa(f,Qa(f,c),d||!1,e||null);if(b){var l=a.getRootNode();if(Ra(l,g))b(g);else var k=setInterval(function(){Ra(l,g)&&(clearInterval(k),b(g))},4)}}
function Pa(a,b,c,d){var e=a.__AMP_CSS_SM;e||(e=a.__AMP_CSS_SM=ha());var f=!c&&d&&"amp-custom"!=d&&"amp-keyframes"!=d,g=c?"amp-runtime":f?"amp-extension="+d:null;if(g){var l=Sa(a,e,g);if(l)return l.textContent!==b&&(l.textContent=b),l}var k=(a.ownerDocument||a).createElement("style");k.textContent=b;var m=null;c?k.setAttribute("amp-runtime",""):f?(k.setAttribute("amp-extension",d||""),m=Sa(a,e,"amp-runtime")):(d&&k.setAttribute(d,""),m=a.lastChild);b=m;a.insertBefore(k,b?b.nextSibling:a.firstChild);
g&&(e[g]=k);return k}function Sa(a,b,c){return b[c]?b[c]:(a=a.querySelector("style["+c+"]"))?b[c]=a:null}function Qa(a,b){return(a=a.__AMP_CSS_TR)?a(b):b}function Ra(a,b){var c=a.styleSheets;for(a=0;a<c.length;a++){var d=c[a];if(d.ownerNode==b)return!0}return!1};function Ta(a,b,c){ta(a).then(function(d){d&&d.triggerEventForTarget(a,b,c)})};self.AMPErrors=self.AMPErrors||[];function R(){this.A=null}h=R.prototype;h.add=function(a){var b=this;this.A||(this.A=[]);this.A.push(a);return function(){b.remove(a)}};h.remove=function(a){this.A&&(a=this.A.indexOf(a),-1<a&&this.A.splice(a,1))};h.removeAll=function(){this.A&&(this.A.length=0)};h.fire=function(a){if(this.A)for(var b=this.A,c=0;c<b.length;c++)(0,b[c])(a)};h.getHandlerCount=function(){return this.A?this.A.length:0};function Wa(a){if("undefined"!==typeof TextDecoder)return(new TextDecoder("utf-8")).decode(a);for(var b=new Uint8Array(a.buffer||a),c=Array(b.length),d=0;d<b.length;d++)c[d]=String.fromCharCode(b[d]);var e=c.join("");return decodeURIComponent(escape(e))}function Xa(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++){var d=a.charCodeAt(c);b[c]=d}return b};var Ya={"-":"+",_:"/",".":"="};function Za(a){var b=atob(a.replace(/[-_.]/g,function(a){return Ya[a]}));return Xa(b)};var $a=function(){function a(a,b,c){var d;c=c||{};for(d=a.length;d--;c[a[d]]=b);return c}function b(){this.yy={}}var c=[1,3],d=[1,4],e=[1,18],f=[1,13],g=[1,14],l=[1,15],k=[1,16],m=[1,17],x=[1,20],N=[1,21],q=[5,6,7,10],v=[5,6,7,10,15,16,17,18,19,20,21],D=[5,6,7,10,15,16,17,18,19,20,21,25],P={trace:function nc(){},yy:{},eb:{error:2,result:3,search_condition:4,EOF:5,OR:6,AND:7,NOT:8,"(":9,")":10,predicate:11,comparison_predicate:12,truthy_predicate:13,scalar_exp:14,EQ:15,DEQ:16,NEQ:17,LT:18,LTE:19,GT:20,
GTE:21,atom:22,field_ref:23,literal:24,DOT:25,field_name:26,NAME:27,STRING:28,NUMERIC:29,TRUE:30,FALSE:31,NULL:32,$accept:0,$end:1},ca:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"NAME",28:"STRING",29:"NUMERIC",30:"TRUE",31:"FALSE",32:"NULL"},Ha:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,1],[26,1],[24,1],[24,1],[24,1],
[24,1],[24,1]],performAction:function oc(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return f[g-1];case 2:this.l=f[g-2]||f[g];break;case 3:this.l=f[g-2]&&f[g];break;case 4:this.l=!f[g];break;case 5:this.l=f[g-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.l=f[g];break;case 9:this.l=f[g-2]===f[g];break;case 10:throw Error('"==" is not allowed, use "="');case 11:this.l=f[g-2]!==f[g];break;case 12:this.l=typeof f[g-2]==typeof f[g]&&f[g-2]<f[g];break;case 13:this.l=typeof f[g-2]==typeof f[g]&&
f[g-2]<=f[g];break;case 14:this.l=typeof f[g-2]==typeof f[g]&&f[g-2]>f[g];break;case 15:this.l=typeof f[g-2]==typeof f[g]&&f[g-2]>=f[g];break;case 16:this.l=void 0!==f[g]&&null!==f[g]&&""!==f[g]&&0!==f[g]&&!1!==f[g];break;case 20:this.l="[object Object]"==Object.prototype.toString.call(f[g-2])&&f[g-2].hasOwnProperty(f[g])?f[g-2][f[g]]:null;break;case 21:this.l=void 0!==d[f[g]]?d[f[g]]:null;break;case 22:this.l=a;break;case 23:this.l=a.substring(1,a.length-1);break;case 24:this.l=Number(a);break;case 25:this.l=
!0;break;case 26:this.l=!1;break;case 27:this.l=null}},table:[{3:1,4:2,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{1:[3]},{5:[1,19],6:x,7:N},{4:22,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{4:23,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},a(q,[2,6]),a(q,[2,7]),a(q,[2,8]),a(q,[2,16],{15:[1,24],16:[1,25],17:[1,26],18:[1,27],19:[1,28],20:[1,29],21:[1,30]}),a(v,[2,17]),a(v,[2,18],{25:[1,
31]}),a(v,[2,19]),a(D,[2,21]),a(v,[2,23]),a(v,[2,24]),a(v,[2,25]),a(v,[2,26]),a(v,[2,27]),a(D,[2,22]),{1:[2,1]},{4:32,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{4:33,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},a(q,[2,4]),{6:x,7:N,10:[1,34]},{14:35,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{14:36,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{14:37,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},
{14:38,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{14:39,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{14:40,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{14:41,22:9,23:10,24:11,26:12,27:e,28:f,29:g,30:l,31:k,32:m},{26:42,27:e},a([5,6,10],[2,2],{7:N}),a(q,[2,3]),a(q,[2,5]),a(q,[2,9]),a(q,[2,10]),a(q,[2,11]),a(q,[2,12]),a(q,[2,13]),a(q,[2,14]),a(q,[2,15]),a(D,[2,20])],defaultActions:{19:[2,1]},parseError:function pc(a,b){if(b.recoverable)this.trace(a);else throw a=Error(a),
a.hash=b,a;},parse:function qc(a){function b(a){d.length-=2*a;f.length-=a;g.length-=a}var c=this,d=[0],e=[],f=[null],g=[],l=this.table,k="",O=0,m=0,q=0,x=2,v=1,N=g.slice.call(arguments,1),p=Object.create(this.lexer),E={yy:{}},w;for(w in this.yy)Object.prototype.hasOwnProperty.call(this.yy,w)&&(E.yy[w]=this.yy[w]);p.setInput(a,E.yy);E.yy.lexer=p;E.yy.parser=this;"undefined"==typeof p.yylloc&&(p.yylloc={});var D=p.yylloc;g.push(D);var P=p.options&&p.options.ranges;this.parseError="function"===typeof E.yy.parseError?
E.yy.parseError:Object.getPrototypeOf(this).parseError;var ra=function(){var a;a=p.lex()||v;"number"!==typeof a&&(a=c.eb[a]||a);return a};for(var r,qa,F,t,K={},W,y,Ua;;){F=d[d.length-1];if(this.defaultActions[F])t=this.defaultActions[F];else{if(null===r||"undefined"==typeof r)r=ra();t=l[F]&&l[F][r]}if("undefined"===typeof t||!t.length||!t[0]){var Va="";w=[];for(W in l[F])this.ca[W]&&W>x&&w.push("'"+this.ca[W]+"'");Va=p.showPosition?"Parse error on line "+(O+1)+":\n"+p.showPosition()+"\nExpecting "+
w.join(", ")+", got '"+(this.ca[r]||r)+"'":"Parse error on line "+(O+1)+": Unexpected "+(r==v?"end of input":"'"+(this.ca[r]||r)+"'");this.parseError(Va,{text:p.match,token:this.ca[r]||r,line:p.yylineno,loc:D,expected:w})}if(t[0]instanceof Array&&1<t.length)throw Error("Parse Error: multiple actions possible at state: "+F+", token: "+r);switch(t[0]){case 1:d.push(r);f.push(p.yytext);g.push(p.yylloc);d.push(t[1]);r=null;qa?(r=qa,qa=null):(m=p.yyleng,k=p.yytext,O=p.yylineno,D=p.yylloc,0<q&&q--);break;
case 2:y=this.Ha[t[1]][1];K.l=f[f.length-y];K.ya={first_line:g[g.length-(y||1)].first_line,last_line:g[g.length-1].last_line,first_column:g[g.length-(y||1)].first_column,last_column:g[g.length-1].last_column};P&&(K.ya.range=[g[g.length-(y||1)].range[0],g[g.length-1].range[1]]);w=this.performAction.apply(K,[k,m,O,E.yy,t[1],f,g].concat(N));if("undefined"!==typeof w)return w;y&&(d=d.slice(0,-2*y),f=f.slice(0,-1*y),g=g.slice(0,-1*y));d.push(this.Ha[t[1]][0]);f.push(K.l);g.push(K.ya);Ua=l[d[d.length-2]][d[d.length-
1]];d.push(Ua);break;case 3:return!0}}}},ra=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},
input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=
this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);a=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},
more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-
this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,
first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,
last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];a=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);
if(a)return a;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,
d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function O(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function rc(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function sc(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function tc(a){this.begin(a)},stateStackSize:function uc(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){var e=d;switch(c){case 1:return 7;case 2:return 6;case 3:return 8;case 4:return 32;case 5:return 30;case 6:return 30;case 7:return 31;
case 8:return 31;case 9:return 9;case 10:return 10;case 11:return"|";case 12:return 19;case 13:return 18;case 14:return 21;case 15:return 20;case 16:return 17;case 17:return 16;case 18:return 15;case 19:return 29;case 20:return 27;case 21:return 28;case 22:return 28;case 23:return 25;case 24:return"INVALID";case 25:return 5}},rules:[/^(?:\s+)/,/^(?:AND\b)/,/^(?:OR\b)/,/^(?:NOT\b)/,/^(?:NULL\b)/,/^(?:TRUE\b)/,/^(?:true\b)/,/^(?:FALSE\b)/,/^(?:false\b)/,/^(?:\()/,/^(?:\))/,/^(?:\|)/,/^(?:<=)/,/^(?:<)/,
/^(?:>=)/,/^(?:>)/,/^(?:!=)/,/^(?:==)/,/^(?:=)/,/^(?:-?[0-9]+(\.[0-9]+)?\b)/,/^(?:[a-zA-Z_][a-zA-Z0-9_]*)/,/^(?:'[^\']*')/,/^(?:"[^\"]*")/,/^(?:\.)/,/^(?:.)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],inclusive:!0}}}}();P.lexer=ra;b.prototype=P;P.Parser=b;return new b}();function ab(a,b){try{return $a.yy=b,!!$a.parse(a)}finally{$a.yy=null}};function bb(a){a=a.trim();a=a.replace(/^\-+BEGIN[^-]*\-+/,"");a=a.replace(/\-+END[^-]*\-+$/,"");a=a.replace(/[\r\n]/g,"").trim();return Xa(atob(a))};function S(a){this.win=a;this.ka=a.crypto&&(a.crypto.subtle||a.crypto.webkitSubtle)||null}S.prototype.decode=function(a){return cb(a).payload};S.prototype.isVerificationSupported=function(){return!!this.ka};
S.prototype.decodeAndVerify=function(a,b){var c=this;if(!this.ka)throw Error("Crypto is not supported on this platform");var d=new Promise(function(b){return b(cb(a))});return d.then(function(a){var d=a.header.alg;if(!d||"RS256"!=d)throw Error("Only alg=RS256 is supported");return db(c,b).then(function(b){var d=Za(a.sig);return c.ka.verify({name:"RSASSA-PKCS1-v1_5"},b,d,Xa(a.verifiable))}).then(function(b){if(b)return a.payload;throw Error("Signature verification failed");})})};
function cb(a){function b(){throw Error('Invalid token: "'+a+'"');}var c=a.split(".");3!=c.length&&b();var d=Za(c[0]),e=Za(c[1]);return{header:Ka(Wa(d),b),payload:Ka(Wa(e),b),verifiable:c[0]+"."+c[1],sig:c[2]}}function db(a,b){return b.then(function(b){return a.ka.importKey("spki",bb(b),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])})};var eb=/RETURN_URL/;function fb(a,b){var c=G(a,"viewer");return(parseInt(c.getParam("dialog"),10)?new gb(c,b):new hb(a.win,c,b)).open()}function gb(a,b){this.viewer=a;this.urlOrPromise=b}gb.prototype.getLoginUrl=function(){var a;a="string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise;return a.then(function(a){return T(a,"RETURN_URL")})};
gb.prototype.open=function(){var a=this;return this.getLoginUrl().then(function(b){return a.viewer.sendMessageAwaitResponse("openDialog",z({url:b}))})};function hb(a,b,c){this.win=a;this.viewer=b;this.urlOrPromise=c;this.ja=this.T=this.Y=this.o=this.ta=this.$=null}hb.prototype.open=function(){var a=this;u().assert(!this.$,"Dialog already opened");return(new Promise(function(b,c){a.$=b;a.ta=c;ib(a)})).then(function(b){jb(a);return b},function(b){jb(a);throw b;})};
function jb(a){a.$=null;a.ta=null;if(a.o){try{a.o.close()}catch(b){}a.o=null}a.T&&(a.win.clearInterval(a.T),a.T=null);a.ja&&(a.ja(),a.ja=null)}hb.prototype.getLoginUrl=function(){var a=this;return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise).then(function(b){return T(b,kb(a))})};
function ib(a){var b=a.win.screen,c=Math.floor(Math.min(700,.9*b.width)),d=Math.floor(Math.min(450,.9*b.height)),e="height="+d+",width="+c+",left="+Math.floor((b.width-c)/2)+",top="+Math.floor((b.height-d)/2),b=e+",resizable=yes,scrollbars=yes",f=kb(a);a.Y=null;"string"==typeof a.urlOrPromise?(c=T(a.urlOrPromise,f),a.o=sa(a.win,c,b),a.o&&(a.Y=Promise.resolve())):(a.o=sa(a.win,"",b),a.o&&(a.Y=a.urlOrPromise.then(function(b){b=T(b,f);a.o.location.replace(b)},function(a){throw Error("failed to resolve url: "+
a);})));a.Y?a.Y.then(function(){lb(a,f)},function(b){U(a,null,b)}):U(a,null,Error("failed to open dialog"))}function lb(a,b){var c=L(b).origin;a.T=a.win.setInterval(function(){a.o.closed&&(a.win.clearInterval(a.T),a.T=null,a.win.setTimeout(function(){U(a,"")},3E3))},500);a.ja=Ha(a.win,function(b){b.origin==c&&b.data&&"amp"==b.data.sentinel&&"result"==b.data.type&&(a.o&&a.o.postMessage(z({sentinel:"amp",type:"result-ack"}),c),U(a,b.data.result))})}function U(a,b,c){a.$&&(c?a.ta(c):a.$(b),jb(a))}
function kb(a){var b,c=a.viewer.getResolvedViewerUrl();return ua.cdn+"/v0/amp-login-done-0.1.html?url="+encodeURIComponent(c)}function T(a,b){return eb.test(a)?a.replace(eb,encodeURIComponent(b)):a+(-1==a.indexOf("?")?"?":"&")+"return="+encodeURIComponent(b)};function mb(a,b,c,d){for(var e in d)Ea(d[e],"action "+e);this.fa=d;this.na={};this.X=b;this.ga=c;this.K=null;this.za=0;this.$a=fb.bind(null,a);this.build()}mb.prototype.build=function(){var a=this;if(0==Object.keys(this.fa).length)return null;var b=[],c={},d;for(d in this.fa)c.k=d,b.push(this.X.buildUrl(this.fa[c.k],!0).then(function(b){return function(c){a.na[b.k]=c}}(c))),c={k:c.k};return Promise.all(b).then(function(){return a.na})};
mb.prototype.execute=function(a){u().assert(this.fa[a],"Action URL is not configured: %s",a);var b=u().assert(this.na[a],"Action URL is not ready: %s",a);return nb(this,b,"subscriptions-action-"+a)};
function nb(a,b,c){var d=Date.now();if(a.K&&1E3>d-a.za)return a.K;a.ga.event(c+"-started");var e=a.$a(b),f=e.then(function(b){a.K=null;b=ca(b).success;var d="true"==b||"yes"==b||"1"==b;d?a.ga.event(c+"-success"):a.ga.event(c+"-rejected");return d||!b}).catch(function(b){a.ga.event(c+"-failed");a.K==f&&(a.K=null);throw b;});a.K=f;a.za=d;return a.K};function ob(a){var b=this;this.h=a;this.ea=B(a.win,"vsync");this.N=B(a.win,"timer");this.la=G(a,"viewport");this.da=!1;this.pa=null;a=this.h.win.document;this.D=na(a,"amp-subscriptions-dialog",{role:"dialog",hidden:""});this.oa=na(a,"button",{"class":"i-amphtml-subs-dialog-close-button"});this.showCloseAction(!1);this.D.appendChild(this.oa);this.oa.addEventListener("click",function(){b.close()});this.h.getBody().appendChild(this.D);Na(this.D,{transform:"translateY(100%)"})}h=ob.prototype;
h.getRoot=function(){return this.D};h.isVisible=function(){return this.da};
h.open=function(a,b){b=void 0===b?!0:b;var c=this;this.pa?this.D.replaceChild(a,this.pa):this.D.appendChild(a);this.pa=a;if(this.da)return Promise.resolve();this.da=!0;return this.ea.mutatePromise(function(){c.D.removeAttribute("hidden");c.showCloseAction(b)}).then(function(){return c.ea.mutatePromise(function(){Na(c.D,{transform:"translateY(0)"});return c.N.promise(300)})}).then(function(){var a;return c.ea.runPromise({measure:function(){a=c.D.offsetHeight},mutate:function(){c.la.updatePaddingBottom(a)}})})};
h.close=function(){var a=this;return this.da?this.ea.mutatePromise(function(){Na(a.D,{transform:"translateY(100%)"});return a.N.promise(300)}).then(function(){return a.ea.mutatePromise(function(){a.D.setAttribute("hidden","");a.la.updatePaddingBottom(0);a.da=!1})}):Promise.resolve()};h.showCloseAction=function(a){var b=this.oa,c=a;void 0===c&&(c=(c=Ma(b.style,"display",void 0))?b.style[c]:void 0,c="none"==c);var c=c?"":"none",d=Ma(b.style,"display",void 0);d&&(b.style[d]=c)};function pb(a){var b=a.readyState;return"loading"!=b&&"uninitialized"!=b}function qb(a,b){var c=pb,d=c(a);if(d)b(a);else{var e=function(){c(a)&&(d||(d=!0,b(a)),a.removeEventListener("readystatechange",e))};a.addEventListener("readystatechange",e)}}function rb(a){return new Promise(function(b){qb(a,b)})}function sb(a){var b=!!a.document;this.hb=b?a:a.defaultView;this.j=b?a.document:a}h=sb.prototype;h.getWin=function(){return this.hb};h.getRootNode=function(){return this.j};h.getRootElement=function(){return this.j.documentElement};
h.getHead=function(){return this.j.head};h.getBody=function(){return this.j.body};h.isReady=function(){return pb(this.j)};h.whenReady=function(){return rb(this.j)};function tb(a){return 9===a.nodeType||a.document?new sb(a):a}function V(a,b){var c,d,e,f=a.indexOf(":");-1!=f?(d=a,c=d.substring(0,f),e=d.substring(f+1)):(c=a,e=d=null);this.sa=c;this.V=d;this.Va=e;this.Xa=b}V.prototype.getPublicationId=function(){return this.sa};V.prototype.getProductId=function(){return this.V};V.prototype.getLabel=function(){return this.Va};
V.prototype.isLocked=function(){return this.Xa};function ub(a){var b=this;this.j=tb(a);this.P=null;this.Qa=new Promise(function(a){b.P=a});this.Ya=new vb(this.j);this.Wa=new wb(this.j);this.Za=new xb(this.j)}ub.prototype.resolveConfig=function(){Promise.resolve().then(this.check.bind(this));this.j.whenReady().then(this.check.bind(this));return this.Qa};
ub.prototype.check=function(){if(!this.P)return null;var a=this.Ya.check();a||(a=this.Wa.check());a||(a=this.Za.check());a?(this.P(a),this.P=null):this.j.isReady()&&(this.P(Promise.reject(Error("No config could be discovered in the page"))),this.P=null);return a};function vb(a){this.j=a}
vb.prototype.check=function(){if(!this.j.getBody())return null;var a=yb(this.j.getRootNode(),"subscriptions-product-id");if(!a)return null;var b=yb(this.j.getRootNode(),"subscriptions-accessible-for-free");return new V(a,b&&"false"==b.toLowerCase()||!1)};function wb(a){this.j=a}
wb.prototype.check=function(){if(!this.j.getBody())return null;for(var a=this.j.isReady(),b=this.j.getRootNode().querySelectorAll('script[type="application/ld+json"]'),c=0;c<b.length;c++){var d=b[c],e;if((e=!d["__SWG-SEEN__"]&&d.textContent)&&!(e=a))a:{e=d;do if(e.nextSibling){e=!0;break a}while((e=e.parentNode)&&void 0!=e);e=!1}if(e&&(d["__SWG-SEEN__"]=!0,-1!=d.textContent.indexOf("NewsArticle"))){var f=this.wa(d);if(f)return f}}return null};
wb.prototype.wa=function(a){var b;a:{try{b=JSON.parse(a.textContent);break a}catch(f){}b=void 0}a=b;if(!a||!zb(a,"NewsArticle"))return null;b=null;var c=Ab(a,"isPartOf");if(c)for(var d=0;d<c.length&&!(b=this.qa(c[d]));d++);if(!b)return null;var e=Bb(Cb(a,"isAccessibleForFree"));return new V(b,!e)};function Bb(a){var b=!0;if(null==a||""===a)return b;if("boolean"==typeof a)return a;if("string"==typeof a){var c=a.toLowerCase();if("false"==c)return!1;if("true"==c)return!0}return b}
wb.prototype.qa=function(a){return zb(a,"Product")?Cb(a,"productID"):null};function Ab(a,b){a=a[b];return null==a||""===a?null:Array.isArray(a)?a:[a]}function Cb(a,b){var c=Ab(a,b);a=c&&c[0];return null==a||""===a?null:a}function zb(a,b){var c=Ab(a,"@type");return c?c.includes(b)||c.includes("http://schema.org/"+b):!1}function xb(a){this.j=a;this.V=this.I=null}
function Db(a,b){for(;a&&!a[b];a=a.parentNode)if(a[b]=!0,a.hasAttribute("itemscope")){if(0<=a.getAttribute("itemtype").indexOf("http://schema.org/NewsArticle"))return!0;break}return!1}xb.prototype.qa=function(a){a=a.querySelectorAll('[itemprop="productID"]');for(var b=0;a[b];b++){var c=a[b],d=c.getAttribute("content")||c.textContent,e=c.closest("[itemtype][itemscope]");if(!(-1>=e.getAttribute("itemtype").indexOf("http://schema.org/Product"))&&Db(e.parentElement,"alreadySeenForProductInfo"))return d}return null};
function Eb(a){var b=null;null!=a.I?b=!a.I:a.j.isReady()&&(b=!1);return null!=a.V&&null!=b?new V(a.V,b):null}
xb.prototype.wa=function(){var a=Eb(this);if(a)return a;for(var b=this.j.getRootNode().querySelectorAll('[itemscope][itemtype*="http://schema.org/NewsArticle"]'),c=0;b[c]&&null==a;c++){a=b[c];if(null==this.I){var d;a:{for(var e=a.querySelectorAll("[itemprop='isAccessibleForFree']"),f=0;e[f];f++){var g=e[f];if((d=g.getAttribute("content")||g.textContent)&&Db(g,"alreadySeenForAccessInfo")){e=null;"true"==d.toLowerCase()?e=!0:"false"==d.toLowerCase()&&(e=!1);d=e;break a}}d=null}this.I=d}this.V||(this.V=
this.qa(a));a=Eb(this)}return a};xb.prototype.check=function(){return this.j.getBody()?this.wa():null};function yb(a,b){return(a=a.querySelector('meta[name="'+b+'"]'))?a.getAttribute("content"):null};function Fb(a){this.h=a}h=Fb.prototype;h.getWin=function(){return this.h.win};h.getRootNode=function(){return this.h.getRootNode()};h.getRootElement=function(){var a=this.h.getRootNode();return a.documentElement||a.body||a};h.getHead=function(){return this.h.getHeadNode()};h.getBody=function(){return this.h.isBodyAvailable()?this.h.getBody():null};h.isReady=function(){return this.h.isReady()};h.whenReady=function(){return this.h.whenReady()};function X(a){var b=a.source,c=void 0===a.raw?"":a.raw,d=a.service,e=void 0===a.granted?!1:a.granted,f=void 0===a.grantReason?"":a.grantReason,g=a.dataObject;this.raw=c;this.source=b;this.service=d;this.granted=e;this.grantReason=f;this.data=g}function Y(a){return new X({source:"",raw:"",service:a,granted:!1})}X.prototype.json=function(){var a=z({source:this.source,service:this.service,granted:this.granted,grantReason:this.grantReason,data:this.data});return a};
X.prototype.jsonForPingback=function(){return Object.assign({},{raw:this.raw},this.json())};function Gb(a){var b;b=void 0===b?null:b;a||(a={});var c=b||JSON.stringify(a);return new X({source:a.source||"",raw:c,service:"",granted:a.granted||!1,grantReason:a.grantReason,dataObject:a.data||null})}X.prototype.isSubscriber=function(){return this.granted&&"SUBSCRIBER"===this.grantReason};function Hb(a,b){a:{if(a.nodeType){var c=(a.ownerDocument||a).defaultView;if(c=c!=(c.__AMP_TOP||c)&&ja(c,"url-replace")?C(c,"url-replace"):null){a=c;break a}}a=G(a,"url-replace")}this.La=a;this.bb=b;this.ma=null}Hb.prototype.setAuthResponse=function(a){this.ma=a};Hb.prototype.buildUrl=function(a,b){var c=this;return Ib(this,b).then(function(b){return c.La.expandUrlAsync(a,b)})};Hb.prototype.collectUrlVars=function(a,b){var c=this;return Ib(this,b).then(function(b){return c.La.collectVars(a,b)})};
function Ib(a,b){return a.bb.then(function(c){var d={READER_ID:c,ACCESS_READER_ID:c};b&&(d.AUTHDATA=function(b){if(a.ma)return Ja(a.ma,b)});return d})};function Jb(a,b,c){this.h=a;this.ua=a.getRootNode();this.o=b;this.fb=B(a.win,"templates");this.B=c}Jb.prototype.render=function(a){return Promise.all([Kb(this,a),Lb(this,a)])};function Kb(a,b){Mb(a,b,a.ua)}
function Lb(a,b){return a.h.whenReady().then(function(){for(var c=a.h.getRootNode().querySelectorAll("[subscriptions-dialog][subscriptions-display]"),d=0;d<c.length;d++){var e=c[d],f=e.getAttribute("subscriptions-display");if(f&&ab(f,b))return e}}).then(function(c){if(c){if("TEMPLATE"==c.tagName)return a.fb.renderTemplate(c,b).then(function(c){return Mb(a,b,c)});var d=c.cloneNode(!0);d.removeAttribute("subscriptions-dialog");d.removeAttribute("subscriptions-display");return d}}).then(function(b){if(b)return a.o.open(b,
!0)})}
function Mb(a,b,c){return a.h.whenReady().then(function(){for(var d='[subscriptions-action], [subscriptions-section="actions"], [subscriptions-actions]',e=c.querySelectorAll(d),f=0;f<e.length;f++){var g=e[f],l=g.getAttribute("subscriptions-display");l&&ab(l,b)?(g.classList.add("i-amphtml-subs-display"),g.getAttribute("subscriptions-service")&&g.getAttribute("subscriptions-action")&&"false"!==g.getAttribute("subscriptions-decorate")&&a.B.decorateServiceAction(g,g.getAttribute("subscriptions-service"),g.getAttribute("subscriptions-action"),
null)):g.classList.remove("i-amphtml-subs-display")}return c})};function Nb(a,b,c,d){this.h=a;this.ua=a.getRootNode();this.aa=b;this.B=c;this.Ma=B(this.h.win,"xhr");this.Na=Ea(u().assert(this.aa.authorizationUrl,"Service config does not have authorization Url"),"Authorization Url");this.X=new Hb(this.h,this.B.getReaderId("local"));this.w=d;u().assert(this.aa.actions,"Actions have not been defined in the service config");this.Aa=new mb(this.h,this.X,this.w,this.validateActionMap(this.aa.actions));this.Z=new Jb(this.h,c.getDialog(),this.B);this.Ga=this.aa.pingbackUrl||
null;Ob(this)}h=Nb.prototype;h.getServiceId=function(){return"local"};h.validateActionMap=function(a){u().assert(a.login,'Action "login" is not present in action map');u().assert(a.subscribe,'Action "subscribe" is not present in action map');return a};
function Ob(a){a.ua.addEventListener("click",function(b){var c=pa(b.target);c&&(b=c.getAttribute("subscriptions-action"),c=c.getAttribute("subscriptions-service"),"local"==c?a.executeAction(b):"auto"==(c||"auto")?"login"==b?(c=a.B.selectPlatformForLogin(),a.B.delegateActionToService(b,c.getServiceId())):a.executeAction(b):c&&a.B.delegateActionToService(b,c))})}h.activate=function(a){var b=this,c=a.json();this.X.setAuthResponse(c);this.Aa.build().then(function(){b.Z.render(c)})};
h.executeAction=function(a){var b=this,c=this.Aa.execute(a);return c.then(function(a){a&&b.B.reAuthorizePlatform(b);return!!a})};h.getEntitlements=function(){var a=this;return this.X.buildUrl(this.Na,!1).then(function(b){return a.Ma.fetchJson(b,{credentials:"include"}).then(function(a){return a.json()}).then(function(a){return Gb(a)})})};h.isPingbackEnabled=function(){return!!this.Ga};
h.pingback=function(a){var b=this;if(this.isPingbackEnabled){var c=this.Ga;return this.X.buildUrl(c,!0).then(function(c){return b.Ma.sendSignal(c,{method:"POST",credentials:"include",headers:z({"Content-Type":"text/plain"}),body:JSON.stringify(a.jsonForPingback())})})}};h.supportsCurrentViewer=function(){return!1};h.getBaseScore=function(){return this.aa.baseScore||0};h.decorateUI=function(){};function Pb(a,b,c){var d=this;this.ba={};this.Ka=a;this.J={};this.ia={};a.forEach(function(a){d.ia[a]=new A});this.Da=new R;this.Fa=new R;this.H=null;this.Ea=new R;this.O=this.S=this.G=null;this.R=[];this.Ta=c;this.cb=Object.assign({supportsViewer:10},b)}h=Pb.prototype;h.resolvePlatform=function(a,b){this.ba[a]=b;this.Fa.fire({serviceId:a})};h.onPlatformResolves=function(a,b){var c=this,d=this.ba[a];d?b(d):this.Fa.add(function(d){d.serviceId===a&&b(c.getPlatform(a))})};h.getPlatform=function(a){return this.ba[a]};
h.getLocalPlatform=function(){var a=this.getPlatform("local");return a};h.getAvailablePlatforms=function(){var a=[],b;for(b in this.ba){var c=this.ba[b];a.push(c)}return a};h.onChange=function(a){this.Da.add(a)};h.resolveEntitlement=function(a,b){b&&(b.service=a);this.J[a]=b;var c=this.ia[a];c&&c.resolve(b);-1!=this.R.indexOf(a)&&this.R.splice(this.R.indexOf(a));this.Da.fire({serviceId:a,entitlement:b})};h.getResolvedEntitlementFor=function(a){return this.J[a]};h.getEntitlementPromiseFor=function(a){return this.ia[a].promise};
h.resetEntitlementFor=function(a){this.ia[a]=new A};h.getGrantStatus=function(){var a=this;if(null!==this.H)return this.H.promise;this.H=new A;for(var b in this.J){var c=this.J[b];c.granted&&(Qb(this,c),this.H.resolve(!0))}if(Z(this))this.H.resolve(!1);else this.onChange(function(b){b=b.entitlement;b.granted?(Qb(a,b),a.H.resolve(!0)):Z(a)&&a.H.resolve(!1)});return this.H.promise};function Qb(a,b){if(!a.G&&b.granted||a.G&&!a.G.isSubscriber()&&b.isSubscriber())a.G=b,a.Ea.fire()}
h.getGrantEntitlement=function(){var a=this;if(this.S)return this.S.promise;this.S=new A;this.G&&this.G.isSubscriber()||Z(this)?this.S.resolve(this.G):this.Ea.add(function(){(a.G.granted||Z(a))&&a.S.resolve(a.G)});return this.S.promise};h.reset=function(){this.H=null};function Rb(a){if(a.O)return a.O.promise;a.O=new A;if(Z(a))a.O.resolve(Sb(a));else a.onChange(function(){Z(a)&&a.O.resolve(Sb(a))});return a.O.promise}function Sb(a){var b=[],c;for(c in a.J)ga.call(a.J,c)&&b.push(a.J[c]);return b}
h.selectPlatform=function(){var a=this;return Rb(this).then(function(){return Tb(a)})};function Z(a){var b=Object.keys(a.J).length;return b===a.Ka.length}
function Tb(a){var b=a.getLocalPlatform(),c=0,d=[];Z(a);a.getAvailablePlatforms().forEach(function(b){var e=0;a.getResolvedEntitlementFor(b.getServiceId()).isSubscriber()&&(e+=1E5);e+=b.getBaseScore();b.supportsCurrentViewer()&&(e+=a.cb.supportsViewer);d.push({platform:b,weight:e});"local"===b.getServiceId()&&(c=e)});d.sort(function(a,b){return b.weight-a.weight});if(0===d.length)return b;var e=d[0].weight;return e>c?d[0].platform:b}
h.reportPlatformFailure=function(a){if(-1==this.R.indexOf(a)){var b=Y(a);this.resolveEntitlement(a,b);this.R.push(a)}this.R.length==this.Ka.length&&(u().warn("amp-subscriptions","All platforms have failed to resolve, using fallback entitlement for local platform"),this.resolveEntitlement(this.getLocalPlatform().getServiceId(),this.Ta))};
h.selectPlatformForLogin=function(){var a=[];this.getAvailablePlatforms().forEach(function(b){var c=0;b.supportsCurrentViewer()&&(c+=1E3);a.push({platform:b,score:c})});a.sort(function(a,c){return c.weight-a.weight});return 0===a.length||0===a[0].score?this.getLocalPlatform():a[0].platform};function Ub(a){this.h=a;this.Ja=G(a,"resources");this.setGrantState(null);this.h.getBody().classList.add("i-amphtml-subs-ready");this.addLoadingBar()}function Vb(a,b){a.Ja.mutateElement(a.h.getBody(),function(){a.h.getBody().classList.toggle("i-amphtml-subs-grant-unk",null===b);a.h.getBody().classList.toggle("i-amphtml-subs-grant-yes",!0===b);a.h.getBody().classList.toggle("i-amphtml-subs-grant-no",!1===b)})}
Ub.prototype.addLoadingBar=function(){var a=this;return this.h.whenReady().then(function(){if(!a.h.getBody().querySelector("[subscriptions-section=loading]")){var b=na(a.h.win.document,"div",z({"class":"i-amphtml-subs-progress","subscriptions-section":"loading"}));a.h.getBody().appendChild(b)}})};function Wb(a,b){a.Ja.mutateElement(a.h.getBody(),function(){a.h.getBody().classList.toggle("i-amphtml-subs-loading",b)})}Ub.prototype.setGrantState=function(a){Vb(this,a)};
Ub.prototype.toggleLoading=function(a){Wb(this,a)};function Xb(a){this.M=a}h=Xb.prototype;h.getPageConfig=function(){return this.M.getPageConfig()};h.getReaderId=function(a){return this.M.getReaderId(a)};h.delegateActionToLocal=function(a){return this.delegateActionToService(a,"local")};h.delegateActionToService=function(a,b){return this.M.delegateActionToService(a,b)};h.decorateServiceAction=function(a,b,c,d){this.M.decorateServiceAction(a,b,c,d)};h.reAuthorizePlatform=function(a){this.M.reAuthorizePlatform(a)};h.getDialog=function(){return this.M.getDialog()};
h.selectPlatformForLogin=function(){return this.M.selectPlatformForLogin()};function Yb(a){this.Sa=a}Yb.prototype.serviceEvent=function(a,b,c){this.event(a,Object.assign({serviceId:b},c))};Yb.prototype.event=function(a,b){Ta(this.Sa,a,b||{})};function Zb(a,b,c,d,e){this.h=a;this.L=c.getPageConfig();this.U=new Nb(a,b,c,e);this.C=G(this.h,"viewer");this.Ua=new S(a.win);this.sa=this.L.getPublicationId();this.Ra=this.L.getProductId();this.ab=d}h=Zb.prototype;
h.getEntitlements=function(){var a=this,b=this.C.sendMessageAwaitResponse("auth",z({publicationId:this.sa,productId:this.Ra,origin:this.ab})).then(function(b){var c=(b||{}).authorization;return c?$b(a,c):Y("local")}).catch(function(b){a.C.sendMessage("auth-rejected",z({reason:b.message}));throw b;});return b};
function $b(a,b){return new Promise(function(c){var d=Ca(a.h.win),e;e=a.h.win.location;"string"==typeof e&&(e=L(e));var f=e;"string"==typeof f&&(f=L(f));if(ua.cdnProxyRegex.test(f.origin)){var f=e.pathname.split("/"),g=f[1];u().assert(va[g],"Unknown path prefix in url %s",e.href);var g=f[2],l="s"==g?"https://"+decodeURIComponent(f[3]):"http://"+decodeURIComponent(g);u().assert(0<l.indexOf("."),"Expected a . in origin %s",l);f.splice(1,"s"==g?3:2);f=l+f.join("/");g=(g=e.search)&&"?"!=g?(g=g.replace(ya,
"").replace(za,"").replace(Aa,"").replace(Ba,"").replace(/^[?&]/,""))?"?"+g:"":"";e=f+g+(e.hash||"")}else e=e.href;e=L(e).origin;var k=a.Ua.decode(b),m=u().assert(a.L.getProductId(),"Product id is null");if(k.aud!=d&&k.aud!=e)throw u().createError('The mismatching "aud" field: '+k.aud);if(k.exp<Math.floor(Date.now()/1E3))throw u().createError("Payload is expired");d=k.entitlements;e=Y("local");if(Array.isArray(d))for(f=0;f<d.length;f++){if(-1!==d[f].products.indexOf(m)){var x=d[f];e=new X({source:"viewer",
raw:b,granted:!0,grantReason:x.subscriptionToken?"SUBSCRIBER":"",dataObject:x});break}}else k.metering&&!k.entitlements?e=new X({source:k.iss||"",raw:b,granted:!0,grantReason:"METERING",dataObject:k.metering}):d&&(e=new X({source:"viewer",raw:b,granted:d.granted,grantReason:d.subscriptionToken?"SUBSCRIBER":"",dataObject:d}));e.service="local";c(e)})}h.getServiceId=function(){return this.U.getServiceId()};h.activate=function(){};h.isPingbackEnabled=function(){return this.U.isPingbackEnabled()};
h.pingback=function(a){this.U.pingback(a)};h.supportsCurrentViewer=function(){return this.U.supportsCurrentViewer()};h.getBaseScore=function(){return 0};h.executeAction=function(a){return this.U.executeAction(a)};h.decorateUI=function(a,b,c){return this.U.decorateUI(a,b,c)};function ac(a){this.h=a;this.C=G(a,"viewer");this.W=null;this.N=B(a.win,"timer");this.la=G(a,"viewport")}ac.prototype.scheduleView=function(a){var b=this;this.W=null;return this.h.whenReady().then(function(){return(new Promise(function(a){b.C.isVisible()&&a();b.C.onVisibilityChanged(function(){b.C.isVisible()&&a()})})).then(function(){return bc(b,a)})})};function bc(a,b){if(a.W)return a.W;a.W=cc(a,b).catch(function(b){a.W=null;throw b;});return a.W}
function cc(a,b){if(0==b)return Promise.resolve();var c=[];return(new Promise(function(d,e){c.push(a.C.onVisibilityChanged(function(){a.C.isVisible()||e(Error("CANCELLED"))}));var f=a.N.delay(d,b);c.push(function(){return a.N.cancel(f)});c.push(a.la.onScroll(d));c.push(Ia(a.h.getRootNode(),d))})).then(function(){c.forEach(function(a){return a()})},function(a){c.forEach(function(a){return a()});throw a;})};function dc(a){var b=a.getElementById("amp-subscriptions");this.h=a;Oa(a,function(){});this.ra=null;this.Z=new Ub(a);this.m=this.F=this.L=null;this.Ba=u().assertElement(b);this.w=new Yb(this.Ba);this.B=new Xb(this);this.o=new ob(a);this.gb=new ac(a);this.C=G(a,"viewer");this.xa=null;this.N=B(a.win,"timer");this.Ca=this.C.hasCapability("auth");this.Pa=la(H(a),"cid");this.Ia={}}
function ec(a){if(!a.ra){var b=new Fb(a.h),c=new ub(b);a.ra=Promise.all([fc(a),c.resolveConfig()]).then(function(b){a.F=b[0];a.L=b[1]})}return a.ra}function fc(a){return new Promise(function(b,c){var d=Ka(a.Ba.textContent,function(a){c('Failed to parse "amp-subscriptions" JSON: '+a)});b(d)})}h=dc.prototype;
h.registerPlatform=function(a,b){var c=this;return ec(this).then(function(){if(!c.Ca){var d=c.F.services.filter(function(b){return(b.serviceId||"local")===a}),e=u().assert(d[0],"No matching services for the ID found"),f=b(e,c.B);c.m.resolvePlatform(f.getServiceId(),f);c.w.serviceEvent("subscriptions-platform-registered",f.getServiceId());gc(c,f)}})};function hc(a,b){a.Z.toggleLoading(!1);a.Z.setGrantState(b);a.xa=a.gb.scheduleView(2E3)}
function gc(a,b){var c=3E3;ea().development&&(c=6E3);return a.C.whenFirstVisible().then(function(){return a.N.timeoutPromise(c,b.getEntitlements()).then(function(c){c=c||Y(b.getServiceId());var d=b.getServiceId();a.m.resolveEntitlement(d,c);a.w.serviceEvent("subscriptions-entitlement-resolved",d);return c}).catch(function(c){var d=b.getServiceId();a.m.reportPlatformFailure(d);throw u().createError("fetch entitlements failed for "+d,c);})})}
h.start=function(){var a=this;ec(this).then(function(){a.w.event("subscriptions-started");a.Z.toggleLoading(!0);u().assert(a.L,"Page config is null");if(a.Ca)ic(a),jc(a,!1);else if(a.F.alwaysGrant)hc(a,!0);else{u().assert(a.F.services,"Services not configured in service config");var b=a.F.services.map(function(a){return a.serviceId||"local"});kc(a,b);a.F.services.forEach(function(b){"local"==(b.serviceId||"local")&&a.m.resolvePlatform("local",new Nb(a.h,b,a.B,a.w))});a.m.getAvailablePlatforms().forEach(function(b){gc(a,
b)});jc(a)}});return this};function kc(a,b){var c=a.F.fallbackEntitlement?Gb(a.F.fallbackEntitlement):Y("local");a.m=new Pb(b,a.F.score,c)}function ic(a){var b=Ca(a.h.win);kc(a,["local"]);a.F.services.forEach(function(c){if("local"==(c.serviceId||"local")){var d=new Zb(a.h,c,a.B,b,a.w);a.m.resolvePlatform("local",d);d.getEntitlements().then(function(b){a.m.resolveEntitlement("local",b)})}})}
h.getReaderId=function(a){var b=this.Ia[a];if(!b){var c=Promise.resolve(),d="amp-access"+("local"==a?"":"-"+a),b=this.Pa.then(function(a){return a.get({scope:d,createCookieIfNotPresent:!0},c)});this.Ia[a]=b}return b};h.getDialog=function(){return this.o};function jc(a,b){b=void 0===b?!0:b;a.m.getGrantStatus().then(function(b){hc(a,b);lc(a)});b&&mc(a)}
function mc(a){var b=Promise.all([a.m.getGrantStatus(),a.m.selectPlatform()]);b.then(function(b){var c=b[1],e=a.m.getResolvedEntitlementFor(c.getServiceId());c.activate(e);a.w.serviceEvent("subscriptions-platform-activated",c.getServiceId());e.granted?a.w.serviceEvent("subscriptions-access-granted",c.getServiceId()):(a.w.serviceEvent("subscriptions-paywall-activated",c.getServiceId()),a.w.serviceEvent("subscriptions-access-denied",c.getServiceId()))})}
function lc(a){a.xa&&a.xa.then(function(){return a.m.getGrantEntitlement()}).then(function(b){var c=a.m.getLocalPlatform();c.isPingbackEnabled()&&c.pingback(b||Y("local"))})}h.getPageConfig=function(){var a=this.L;return a};h.reAuthorizePlatform=function(a){var b=this;this.m.resetEntitlementFor(a.getServiceId());return gc(this,a).then(function(){b.w.serviceEvent("subscriptions-platform-re-authorized",a.getServiceId());b.m.reset();jc(b)})};
h.delegateActionToLocal=function(a){return this.delegateActionToService(a,"local")};h.delegateActionToService=function(a,b){var c=this;return new Promise(function(d){c.m.onPlatformResolves(b,function(e){c.w.event("subscriptions-action-delegated",{action:a,serviceId:b});d(e.executeAction(a))})})};h.decorateServiceAction=function(a,b,c,d){this.m.onPlatformResolves(b,function(b){b.decorateUI(a,c,d)})};h.selectPlatformForLogin=function(){return this.m.selectPlatformForLogin()};
h.getAccessReaderId=function(){var a=this;return ec(this).then(function(){return a.getReaderId("local")})};h.getAuthdataField=function(a){var b=this;return ec(this).then(function(){return b.m.getEntitlementPromiseFor("local")}).then(function(b){return Ja(b.json(),a)})};(function(a){a.registerServiceForDoc("subscriptions",function(a){return(new dc(a)).start()})})(self.AMP);
})});
//# sourceMappingURL=amp-subscriptions-0.1.js.map

