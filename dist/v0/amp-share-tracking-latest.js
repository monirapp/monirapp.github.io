(self.AMP=self.AMP||[]).push({n:"amp-share-tracking",v:"0",f:(function(AMP,_){
function h(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]}function k(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var l=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;self.log=self.log||{user:null,dev:null,userForEmbed:null};var n=self.log;function p(){if(!n.user)throw Error("failed to call initLogConstructor");return n.user};function q(a){return new Promise(function(b){b(a())})};function r(a,b){var c,d=a=a.__AMP_TOP||a,e=a,f=t(d),g=f["share-tracking"];g||(g=f["share-tracking"]={obj:null,promise:null,resolve:null,context:null,ctor:null});g.ctor||g.obj||(g.ctor=b,g.context=e,g.resolve&&u(d,"share-tracking"));c&&u(a,"share-tracking")}function v(a,b){a=a.__AMP_TOP||a;return u(a,b)}function w(a){var b=x(a),b=x(b),b=b.isSingleDoc()?b.win:b;return u(b,"history")}function x(a){return a.nodeType?v((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}
function u(a,b){var c=t(a);a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function t(a){var b=a.services;b||(b=a.services={});return b};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function y(a){var b="amp-share-tracking",c;if(a.__AMP__EXPERIMENT_TOGGLES)c=a.__AMP__EXPERIMENT_TOGGLES;else{a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);c=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var d in a.AMP_CONFIG){var e=a.AMP_CONFIG[d];"number"===typeof e&&0<=e&&1>=e&&(c[d]=Math.random()<e)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length&&(d=a.AMP_CONFIG["allow-doc-opt-in"],e=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]')))for(var e=
e.getAttribute("content").split(","),f=0;f<e.length;f++)-1!=d.indexOf(e[f])&&(c[e[f]]=!0);Object.assign(c,z(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){d=a.AMP_CONFIG["allow-url-opt-in"];e=a.location.originalHash||a.location.hash;a=Object.create(null);if(e)for(var g;g=l.exec(e);)f=k(g[1],g[1]),g=g[2]?k(g[2],g[2]):"",a[f]=g;for(e=0;e<d.length;e++)f=a["e-"+d[e]],"1"==f&&(c[d[e]]=!0),"0"==f&&(c[d[e]]=!1)}}var m=c;return!!m[b]}
function z(a){a:{var b;try{b=a.document.cookie}catch(g){b=""}if(a=b)for(a=a.split(";"),b=0;b<a.length;b++){var c=a[b].trim(),d=c.indexOf("=");if(-1!=d&&"AMP_EXP"==k(c.substring(0,d).trim(),void 0)){a=c.substring(d+1).trim();a=k(a,a);break a}}a=null}var e=a,f=e?e.split(/\s*,\s*/g):[];a=Object.create(null);for(b=0;b<f.length;b++)0!=f[b].length&&("-"==f[b][0]?a[f[b].substr(1)]=!1:a[f[b]]=!0);return a};function A(a){for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=String.fromCharCode(a[c]);return b.join("")};var B={"+":"-","/":"_","=":"."};function C(a){a=A(a);return btoa(a).replace(/[+/=]/g,function(a){return B[a]})};function D(a){a=AMP.BaseElement.call(this,a)||this;a.h="";a.c="";return a}h(D,AMP.BaseElement);D.prototype.isLayoutSupported=function(a){return"nodisplay"==a||"container"==a};
D.prototype.buildCallback=function(){var a=this;y(this.win)||(r(this.win,function(){return Promise.reject(p().createError("amp-share-tracking disabled"))}),p().assert(!1,"amp-share-tracking experiment is disabled"));this.h=this.element.getAttribute("data-href");var b=Promise.all([E(this),F(this)]).then(function(b){var d=b[0],c=b[1];if(c&&""!=c){var f=d,f=f?a.c.substr(f.length+1):a.c,g="."+c;f&&("&"!=f[0]&&(g+="&"),g+=f);var m=g;w(a.getAmpDoc()).updateFragment(m)}return{incomingFragment:d,outgoingFragment:c}});
r(this.win,function(){return b})};function E(a){return G(a).then(function(a){return(a=a.match(/^\.([^&]*)/))?a[1]:""})}function G(a){return w(a.getAmpDoc()).getFragment().then(function(b){return a.c=b})}function F(a){return a.h?H(a,a.h):q(function(){var b;b=a.win;if(b.crypto&&b.crypto.getRandomValues){var c=new Uint8Array(6);b.crypto.getRandomValues(c);b=c}else b=null;if(!b){b=new Uint8Array(6);for(var c=Math.random(),d=0;6>d;d++)c*=256,b[d]=Math.floor(c),c-=b[d]}return C(b)})}
function H(a,b){var c={method:"POST",credentials:"include",body:{}};return v(a.win,"xhr").fetchJson(b,c).then(function(a){return a.json()}).then(function(c){if(c.fragment)return c.fragment;a.user().error("amp-share-tracking","The response from ["+b+"] does not have a fragment value.");return""},function(b){a.user().error("amp-share-tracking","The request to share-tracking endpoint failed:",b);return""})}(function(a){a.registerElement("amp-share-tracking",D)})(self.AMP);
})});
//# sourceMappingURL=amp-share-tracking-0.1.js.map

